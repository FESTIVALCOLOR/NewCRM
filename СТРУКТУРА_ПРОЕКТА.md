# Структура проекта Interior Studio CRM

```
d:\New CRM\interior_studio\
│
├── main.py                          # Точка входа приложения
├── config.py                        # Конфигурация приложения
├── InteriorStudio.spec              # Конфигурация PyInstaller
│
├── database/
│   ├── __init__.py                  # !!! ВАЖНО: Делает database пакетом Python
│   ├── db_manager.py                # Менеджер базы данных
│   └── interior_studio.db           # База данных SQLite
│
├── ui/                              # Модули интерфейса
│   ├── __init__.py                  # !!! ВАЖНО: Делает ui пакетом Python
│   ├── login_window.py              # Окно входа
│   ├── main_window.py               # Главное окно
│   ├── clients_tab.py               # Вкладка клиентов
│   ├── contracts_tab.py             # Вкладка договоров
│   ├── crm_tab.py                   # Вкладка CRM
│   ├── crm_supervision_tab.py       # Вкладка супервизии
│   ├── dashboard_tab.py             # Вкладка дашборда
│   ├── employees_tab.py             # Вкладка сотрудников
│   ├── employee_reports_tab.py      # Вкладка отчетов сотрудников
│   ├── reports_tab.py               # Вкладка отчетов
│   ├── salaries_tab.py              # Вкладка зарплат
│   ├── custom_title_bar.py          # Кастомный заголовок
│   ├── custom_combobox.py           # Кастомный ComboBox
│   ├── custom_dateedit.py           # Кастомный DateEdit
│   ├── custom_message_box.py        # Кастомное MessageBox
│   ├── file_gallery_widget.py       # Виджет галереи файлов
│   ├── file_list_widget.py          # Виджет списка файлов
│   ├── file_preview_widget.py       # Виджет предпросмотра файлов
│   ├── variation_gallery_widget.py  # Виджет галереи вариаций
│   ├── flow_layout.py               # Flow Layout
│   ├── rates_dialog.py              # Диалог тарифов
│   └── update_dialogs.py            # Диалоги обновлений
│
├── utils/                           # Утилиты
│   ├── __init__.py                  # !!! ВАЖНО: Делает utils пакетом Python
│   ├── resource_path.py             # !!! ВАЖНО: Определение путей к ресурсам для exe
│   ├── logger.py                    # Логирование
│   ├── password_utils.py            # Работа с паролями
│   ├── yandex_disk.py               # Интеграция с Яндекс.Диском
│   ├── calendar_styles.py           # Стили календаря
│   ├── global_styles.py             # Глобальные стили
│   ├── db_security.py               # Безопасность БД
│   ├── update_manager.py            # Менеджер обновлений
│   ├── cache_manager.py             # Менеджер кэша
│   ├── constants.py                 # Константы
│   ├── custom_style.py              # Кастомные стили
│   ├── date_utils.py                # Работа с датами
│   ├── icon_loader.py               # Загрузчик иконок
│   ├── message_helper.py            # Помощник сообщений
│   ├── pdf_generator.py             # Генератор PDF
│   ├── preview_generator.py         # Генератор превью
│   ├── tab_helpers.py               # Помощники вкладок
│   ├── tooltip_fix.py               # Исправление tooltip
│   └── validators.py                # Валидаторы
│
├── resources/                       # Ресурсы приложения
│   ├── styles.qss                   # Главный файл стилей
│   ├── logo.png                     # Логотип приложения
│   ├── icon.ico                     # Иконка приложения
│   └── icons/                       # Папка с иконками (SVG)
│       ├── edit.svg
│       ├── delete.svg
│       ├── refresh.svg
│       ├── save.svg
│       ├── add.svg
│       └── ... (множество других SVG иконок)
│
├── dist/                            # Папка с собранным exe
│   ├── InteriorStudio.exe           # Готовый exe файл
│   └── logs/                        # Логи работы exe
│
├── build/                           # Временные файлы PyInstaller
├── preview_cache/                   # Кэш превью
├── logs/                            # Логи разработки
│
└── .venv/                           # Виртуальное окружение Python
```

---

## Ключевые моменты структуры:

### 1. **Файлы __init__.py**

Эти файлы **критически важны** для работы Python пакетов:
- `database/__init__.py`
- `ui/__init__.py`
- `utils/__init__.py`

Без них PyInstaller не может правильно упаковать модули.

### 2. **utils/resource_path.py**

Этот модуль **критически важен** для работы exe:

```python
def resource_path(relative_path):
    """Определяет правильный путь к ресурсам"""
    try:
        base_path = sys._MEIPASS  # В exe файле
    except Exception:
        base_path = os.path.abspath(".")  # В режиме разработки
    return os.path.join(base_path, relative_path)
```

**Как использовать:**
```python
from utils.resource_path import resource_path

# Загрузка логотипа
logo = QPixmap(resource_path('resources/logo.png'))

# Загрузка иконки
icon = QIcon(resource_path('resources/icons/edit.svg'))

# Загрузка стилей
with open(resource_path('resources/styles.qss'), 'r') as f:
    styles = f.read()
```

### 3. **InteriorStudio.spec**

Конфигурация для PyInstaller:

```python
datas=[
    ('resources', 'resources'),  # Копирует всю папку resources
],
hiddenimports=[
    'PyQt5.QtCore',
    'PyQt5.QtGui',
    'PyQt5.QtWidgets',
    'PyQt5.QtSvg',
    'requests',
    'sqlite3',
    'ui',
    'ui.login_window',
    # ... все остальные модули
],
```

### 4. **База данных**

База данных **НЕ включена** в exe файл. Она должна находиться:
- При запуске из Python: `d:\New CRM\interior_studio\interior_studio.db`
- При запуске exe: `d:\New CRM\interior_studio\dist\interior_studio.db`

---

## Правила для добавления новых файлов:

### Добавление нового UI модуля:

1. Создайте файл: `ui/new_module.py`
2. Добавьте импорт в начало:
   ```python
   from utils.resource_path import resource_path
   ```
3. Используйте `resource_path()` для всех ресурсов
4. Добавьте в `InteriorStudio.spec`:
   ```python
   hiddenimports=[
       ...
       'ui.new_module',
   ],
   ```

### Добавление нового утилитного модуля:

1. Создайте файл: `utils/new_util.py`
2. Добавьте в `InteriorStudio.spec`:
   ```python
   hiddenimports=[
       ...
       'utils.new_util',
   ],
   ```

### Добавление новых ресурсов:

1. Поместите файл в `resources/` или `resources/icons/`
2. Используйте `resource_path()` для доступа:
   ```python
   path = resource_path('resources/new_image.png')
   ```

---

## Команды для сборки:

### Разработка (запуск через Python):
```bash
.venv\Scripts\python.exe main.py
```

### Применение миграций БД:
```bash
.venv\Scripts\python.exe -c "from database.db_manager import DatabaseManager; db = DatabaseManager(); print('Migrations completed')"
```

### Сборка exe:
```bash
.venv\Scripts\pyinstaller.exe InteriorStudio.spec --clean --noconfirm
```

### Автоматическое исправление путей в UI файлах:
```bash
.venv\Scripts\python.exe fix_resource_paths.py
```

---

## Проблемы и решения:

### Проблема: "No module named 'ui.login_window'"
**Причина:** Отсутствует файл `database/__init__.py`
**Решение:** Создать пустой файл `database/__init__.py`

### Проблема: Ресурсы не загружаются в exe
**Причина:** Используются прямые относительные пути
**Решение:** Использовать `resource_path()` для всех ресурсов

### Проблема: Модуль не включен в exe
**Причина:** Модуль не указан в `hiddenimports`
**Решение:** Добавить модуль в список `hiddenimports` в `InteriorStudio.spec`

---

**Дата:** 21.12.2025
**Версия:** 1.0.0
